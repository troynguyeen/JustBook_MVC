@model JustBook.ViewModel.SanPhamViewModel
@{
    ViewBag.Title = "EditProduct";
    Layout = "~/Views/Header.cshtml";
}

<div class="content-add-product" style="margin: 0; padding: 50px 0;">
    <div>
        <a href="@Url.Action("ProductManagement", "AdminHome")" style="color: #337ab7; padding-right: 30px; font-size: 20px">
            <span class="fas fa-arrow-left" style="font-size: 18px;"></span>
            Trở về
        </a>
    </div>
    <div class="card-todolist" style="margin: 0;">
        <h2 class="hending" style="padding-bottom: 30px; font-weight: bold;">Cập nhật sản phẩm</h2>
        <form class="fromadd_01" id="add_product">
            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 ">Mã sản phẩm</label>
                    <input readonly id="MaSP" value="@Model.MaSP" autocomplete="off" type="text" placeholder="Nhập mã sản phẩm" style="width: 450px; border: 1px solid;" required>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Tên sản phẩm</label>
                    <input id="TenSP" value="@Model.TenSP" autocomplete="off" type="text" placeholder="Nhập tên sản phẩm" style="width: 450px; border: 1px solid;" required>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Loại sách</label>
                    @Html.DropDownListFor(model => model.MaLoaiSP, new SelectList(Model.CategorySelectListItem, "Value", "Text", @Model.MaLoaiSP),
                        new { @style = "width: 250px; border: 1px solid; border-radius: 0px;", required = "required" })
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Tác giả</label>
                    <input id="TacGia" value="@Model.TacGia" required autocomplete="off" type="text" placeholder="Nhập tên tác giả" style="width: 450px; border: 1px solid;">
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Nhà xuất bản</label>
                    <input id="NXB" value="@Model.NXB" required autocomplete="off" type="text" placeholder="Nhập NXB" class="text_input_01">
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Đơn giá</label>
                    <input id="DonGia" value="@Model.DonGia" required autocomplete="off" type="number" class="text_input_01" min="1" oninput="validity.valid||(value='');"><samp> (VND)</samp>
                </div>
            </div>

            <div class="rowsp_01 ">
                <div class="col_01 col_left">
                    <label class="text_label_01 mt_01">Loại bìa</label>
                    <select id="LoaiBia" autocomplete="off" name="LoaiBia" style="padding: 5px; border: 1px solid; border-radius: 0px;">
                        @if (@Model.LoaiBia == "Bìa cứng")
                        {
                            <option selected value="Bìa cứng">Bìa cứng</option>
                            <option value="Bìa mềm">Bìa mềm</option>
                        }
                        else
                        {
                            <option value="Bìa cứng">Bìa cứng</option>
                            <option selected value="Bìa mềm">Bìa mềm</option>
                        }
                    </select>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Số lượng</label>
                    <input id="SoLuong" value="@Model.SoLuong" required autocomplete="off" type="number" class="text_input_01" min="0" oninput="validity.valid||(value='');">
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Số trang</label>
                    <input id="SoTrang" value="@Model.SoTrang" required autocomplete="off" type="number" class="text_input_01" min="1" oninput="validity.valid||(value='');">
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Kích thước</label>
                    <input id="KichThuoc" value="@Model.KichThuoc" required autocomplete="off" type="number" class="text_input_01" min="1"><samp> (cm)</samp>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01">
                    <label class="text_label_01 mt_01">Trọng lượng</label>
                    <input id="TrongLuong" value="@Model.TrongLuong" required autocomplete="off" type="number" class="text_input_01" min="1"><samp> (kg)</samp>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01 ">
                    <label class="text_label_01 mt_01">Hình ảnh</label>
                    <input type="file" name="image" class="input_img_01" id="ImagePath" required>
                    <div class="image_aria " id="image_aria">
                        <img src="@Url.Content(@Model.ImageLink)" alt="anhSP" class="anh">
                        <span class="them_image">Hình đại diện sách</span>
                    </div>
                </div>
            </div>

            <div class="rowsp_01">
                <div class="col_01 col_len">
                    <label class="text_label_01 mt_01">Mô tả</label>
                    <textarea required rows="10" cols="70" id="MoTa" name="mota" form="add_product" placeholder="Nhập mô tả" autocomplete="off" class="text_input_01">@Model.MoTa</textarea>
                </div>
            </div>

            <div style="display: flex; justify-content: space-evenly;">
                <input class="btn btn-primary" type="button" name="submit" value="Lưu lại thay đổi" onclick="SaveItem()">
                <input class="btn btn-danger" type="reset" name="reset" value="Reset ban đầu" onclick="ResetImage()">
            </div>
        </form>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    const image = document.getElementById("ImagePath");
    const vunganh = document.getElementById("image_aria");
    const anh = vunganh.querySelector(".anh");
    const anhtext = vunganh.querySelector(".them_image");
    const ImagePath = $("img[class=anh]").attr("src");

    $(document).ready(function () {
        anhtext.style.display = "none";
        anh.style.display = "block";
    });

    image.addEventListener("change", function () {

        const file = this.files[0];

        if (file) {
            const reader = new FileReader();

            anhtext.style.display = "none";
            anh.style.display = "block";

            reader.addEventListener("load", function () {
                anh.setAttribute("src", this.result);
            });

            reader.readAsDataURL(file);

        }
    });

    function ResetImage() {
        $("img[class=anh]").attr("src", ImagePath);
    }

    function SaveItem() {
        var formData = new FormData();
        formData.append("MaLoaiSP", $("#MaLoaiSP").val());
        formData.append("MaSP", $("#MaSP").val());
        formData.append("TenSP", $("#TenSP").val());
        formData.append("TacGia", $("#TacGia").val());
        formData.append("NXB", $("#NXB").val());
        formData.append("DonGia", $("#DonGia").val());
        formData.append("MoTa", $("#MoTa").val());
        formData.append("SoLuong", $("#SoLuong").val());
        formData.append("SoTrang", $("#SoTrang").val());
        formData.append("TrongLuong", $("#TrongLuong").val());
        formData.append("KichThuoc", $("#KichThuoc").val());
        formData.append("LoaiBia", $("#LoaiBia").val());
        formData.append("ImagePath", $("#ImagePath").get(0).files[0]);

        $.ajax({
            async: true,
            dataType: 'JSON',
            type: 'POST',
            contentType: false,
            processData: false,
            url: '/AdminHome/EditProduct',
            data: formData,
            success: function (data) {
                if (data.Success) {
                    alert(data.Message);
                    window.location.href = '@Url.Action("ProductManagement", "AdminHome")';
                } else {
                    alert(data.Message);
                }
            },
            error: function (error) {
                alert("Có lỗi " + error);
            }
        });
    }

</script>

